cscope 15 $HOME/ratos               0000057875
	@common.c

1 
	~"commÚ.h
"

3 
	$outb
(
ušt16
 
pÜt
, 
ušt8
 
v®ue
)

5 
asm
 vŞ©e("outb %1, %0" : : "dN" (
pÜt
), "a" (
v®ue
));

6 
	}
}

8 
ušt8
 
	$šb
(
ušt16
 
pÜt
)

10 
ušt8
 
»t
;

11 
asm
 vŞ©e("šb %1, %0" : "÷" (
»t
è: "dN" (
pÜt
));

12  
»t
;

13 
	}
}

16 
	$ou
(
ušt32
 
v®
, 
ušt16
 
pÜt
)

18 
asm
 vŞ©e("ou %0,%1" : : "a" (
v®
), "dN" (
pÜt
));

19 
	}
}

21 
ušt32
 
	$šl
(
ušt16
 
pÜt
)

23 
ušt32
 
v®
;

24 
asm
 vŞ©e("šÈ%1,%0" : "÷" (
v®
è: "dN" (
pÜt
));

25  
v®
;

26 
	}
}

28 
ušt16
 
	$šw
(
ušt16
 
pÜt
)

30 
ušt16
 
»t
;

31 
asm
 vŞ©("šw %1, %0" : "÷" (
»t
è: "dN" (
pÜt
));

32  
»t
;

33 
	}
}

35 
	$buzywa™
(
ušt32
 
time
)

37 
i
;

38 
i
=0;i<10000000*
time
;i++)

40 
	}
}

41 
	$mem£t
(
ušt32
 *
de¡
, 
v®
, ušt32 
size
)

43 
i
;

44 
ušt32
 *
poi
 = 
de¡
;

45 
i
=0;i<
size
;i++)

47 *
poi
 = 
v®
;

48 
poi
++;

50 
	}
}

	@debug.c

1 
	~"debug.h
"

2 
	~"sü“n.h
"

4 
	$DoCÜeDump
()

6 
	`puts
("Doing Core Dump\n");

7 
a
 = 1;

8 1è{ 
a
++ ;}

9 
	`putšt
(
a
);

10 
	}
}

	@gdt.c

1 
	~"gdt.h
"

3 
gdt_’Œy_s
 
	ggdt_’Œ›s
[3];

5 
	$flgd‰abË
Ğ
št32
 
i
, iÁ32 
ba£
, 
ušt32
 
lim™
, 
št8
 
acûss
, 
ušt8
 
g¿n
 )

7 
gdt_’Œ›s
[
i
].
ba£low
 = (
ba£
 & 0xFFFF);

8 
gdt_’Œ›s
[
i
].
ba£middË
 = (
ba£
 >> 16) & 0xFF;

9 
gdt_’Œ›s
[
i
].
ba£high
 = (
ba£
 >> 24) & 0xFF;

10 
gdt_’Œ›s
[
i
].
lim™low
 = (
lim™
 & 0xFFFF);

11 
gdt_’Œ›s
[
i
].
lim™highªdæag
 = (
lim™
 >> 16) & 0x0F;

12 
gdt_’Œ›s
[
i
].
lim™highªdæag
 |ğ
g¿n
 & 0xF0;

13 
gdt_’Œ›s
[
i
].
acûssby‹
 = 
acûss
;

14 
	}
}

17 
gdt_desc_s
 
	ggdt_poš‹r
;

19 
	$š™Ÿlizegdt
()

22 
gdt_poš‹r
.
lim™
 = (5*((
gdt_’Œy_s
)))-1;

23 
	`flgd‰abË
(0,0,0,0,0);

24 
	}
}

	@idt.c

1 
	~"idt.h
"

2 
	~"i¤.h
"

4 
IDTDesü_t
 
	gid‹Ár›s
[256];

6 
œq_»m­
();

7 
	$flid‰abË
(
ušt32
 
off£t
, 
šdex
, 
ušt8
 
ty³
 )

9 
id‹Ár›s
[
šdex
].
off£t_2
 = (
off£t
 >> 16 ) & 0xffff ;

10 
id‹Ár›s
[
šdex
].
£ËùÜ
 = 0x08;

11 
id‹Ár›s
[
šdex
].
z”o
 = 0 ;

12 
id‹Ár›s
[
šdex
].
ty³_©Œ
 = 
ty³
;

14 
id‹Ár›s
[
šdex
].
off£t_1
 = (
off£t
) & 0xffff;

15 
	}
}

17 
idt_±r_t
 
	gidoš‹r
;

19 
	$š™Ÿlizeidt
()

21 
idoš‹r
.
lim™
 = (
IDTDesü_t
) * 256 -1;

22 
idoš‹r
.
ba£
 = (
ušt32
 ) &
id‹Ár›s
[0];

23 
	`flid‰abË
((
ušt32
)
i¤0
, 0, 0x8e);

24 
	`flid‰abË
((
ušt32
)
i¤1
, 1, 0x8e);

25 
	`flid‰abË
((
ušt32
)
i¤2
, 16, 0x8e);

26 
	`flid‰abË
((
ušt32
)
i¤8
, 8, 0x8e);

27 
	`flid‰abË
((
ušt32
)
i¤14
, 14, 0x8e);

28 
	`flid‰abË
((
ušt32
)
i¤32
, 32, 0x8e);

29 
	`flid‰abË
((
ušt32
)
i¤33
, 33, 0x8e);

30 
	`idt_æush
((
ušt32
)&
idoš‹r
);

31 
	`œq_»m­
();

32 
	`š™Ÿlizei¤
();

33 
	}
}

44 
	$œq_»m­
()

46 
	`outb
(0x20, 0x11);

47 
	`outb
(0xA0, 0x11);

48 
	`outb
(0x21, 0x20);

49 
	`outb
(0xA1, 0x28);

50 
	`outb
(0x21, 0x04);

51 
	`outb
(0xA1, 0x02);

52 
	`outb
(0x21, 0x01);

53 
	`outb
(0xA1, 0x01);

54 
	`outb
(0x21, 0x0);

55 
	`outb
(0xA1, 0x0);

56 
	}
}

	@iheap.c

4 
	~"ih—p.h
"

5 
	~"debug.h
"

6 
ušt32
 
’d
;

7 
ušt32
 
	g¶aûm’t_add»ss
 = (ušt32)&
’d
 + 0x1000;

8 
ušt32
 
	gKM®locS¹šgAdd»ss
 = 0;

9 
ušt32
 
	gKM®locSize
 = 500 * 1024 * 1024;

10 
	#M®locCÚs™’cyV®ue
 123

	)

11 
	shŞes


13 
ušt8
 
	mcc
;

14 
ušt32
 
	mËngth
;

15 
hŞes
 *
	mÃxt
;

16 
ušt8
 
	mIsHŞe
;

19 
hŞes
 *
	gh—d
 = 
NULL
;

21 
ušt32
 
	$km®loc
Ğ
ušt32
 
size
 )

23 
ušt32
 
»tuºadd»ss
=0;

24 ifĞ
h—d
 =ğ
NULL
 )

26 ifĞ
KM®locS¹šgAdd»ss
 )

28 
h—d
 = 
KM®locS¹šgAdd»ss
;

29 
h—d
->
IsHŞe
 = 0;

30 
h—d
->
cc
 = 
M®locCÚs™’cyV®ue
;

31 
h—d
->
Ëngth
 = 
size
;

32 
hŞes
 *
‹mp
 = (
ušt32
è
h—d
 + 
size
 + (holes);

33 
‹mp
->
IsHŞe
 = 1;

34 
‹mp
->
cc
 = 
M®locCÚs™’cyV®ue
;

35 
‹mp
->
Ëngth
 = 
KM®locSize
 - 
size
 - 2*(
hŞes
);

36 
h—d
->
Ãxt
 = 
‹mp
;

37 
‹mp
->
Ãxt
 = 
NULL
;

38 
»tuºadd»ss
 = (
ušt32
 )
h—d
 + (
hŞes
);

39 
	`puts
("Initiatinghe malloc\n");

43 
	`puts
(" malloc failed‡t step 1 \n");

49 
hŞes
 *
±r
 = 
h—d
;

50 
±r
 && (±r->
Ëngth
 < 
size
 + (
hŞes
èè|| (±r->
IsHŞe
 == 0))

52 ifĞ
±r
->
Ãxt
 =ğ
NULL
 )

54 
	`puts
("malloc failed‡t step 2\n");

55 
	`putšt
(
±r
->
Ëngth
); 
	`puts
(" ");…utštÕŒ->
IsHŞe
);

56 
	`puts
(" "); 
	`putšt
(
±r
->
Ãxt
);

57 
	`puts
("next\n");

58 
	`DoCÜeDump
();

61 
±r
 =…Œ->
Ãxt
;

65 
hŞes
 *
‹mp
 = (
ušt32
è
±r
 + 
size
 + (holes);

66 
‹mp
->
Ëngth
 = 
±r
->Ëngth - 
size
 - (
hŞes
);

67 
‹mp
->
Ãxt
 = 
±r
->next;

68 
‹mp
->
cc
 = 
M®locCÚs™’cyV®ue
;

69 
‹mp
->
IsHŞe
 = 1;

70 
±r
->
Ãxt
 = 
‹mp
;

71 
±r
->
IsHŞe
 = 0;

72 
±r
->
Ëngth
 = 
size
;

73 
»tuºadd»ss
 = (
ušt32
è
±r
 + (
hŞes
);

74 
	`puts
("Allocating memory from malloc \n");

76  
»tuºadd»ss
;

77 
	}
}

80 
	$kä“
(
ušt32
 
add»ss
)

82 
hŞes
 *
±r
 = 
h—d
;

83 
hŞes
 *
Ï¡
 = 
NULL
;

84 Ğ
±r
 !ğ
NULL
è&& ( ((
ušt32
è±¸+ (
hŞes
)è!ğ
add»ss
) )

86 
Ï¡
 = 
±r
;

87 
	`puts
("in\n");

88 
Ï¡
 = 
±r
;

89 
±r
 =…Œ->
Ãxt
;

91 ifĞ(
±r
 =ğ
NULL
è|| (±r->
cc
 !ğ
M®locCÚs™’cyV®ue
) )

93 
	`puts
("Malloc get corrupted\n");

94 ifĞ
±r
 =ğ
NULL
 )

96 
	`puts
("freeing‡ddress‚ot found\n");

98 
	`DoCÜeDump
();

100 ifĞ(
Ï¡
!=
NULL
è&& (†a¡->
IsHŞe
 == 1))

102 
Ï¡
->
Ãxt
 = 
±r
->next;

103 
Ï¡
->
Ëngth
 =†a¡->Ëngth + 
±r
->Ëngth + (
hŞes
);

107 
±r
->
IsHŞe
 = 1;

108 
Ï¡
 = 
±r
;

109 
	`puts
("in\n");

111 if((
Ï¡
->
Ãxt
 !ğ
NULL
è&& (Ï¡->Ãxt->
IsHŞe
 == 1))

113 
Ï¡
->
Ëngth
 =†a¡->Ëngth +†a¡->
Ãxt
->Ëngth + (
hŞes
);

114 
Ï¡
->
Ãxt
 =†ast->next->next;

115 
	`puts
("in\n");

117 
	}
}

120 
ušt32
 
	$im®loc
(
size
)

122 ià(
¶aûm’t_add»ss
 & 0xFFFFF000)

125 
¶aûm’t_add»ss
 &= 0xFFFFF000;

126 
¶aûm’t_add»ss
 += 0x1000;

128 
ušt32
 
tmp
 = 
¶aûm’t_add»ss
;

129 
¶aûm’t_add»ss
 +ğ
size
;

130  
tmp
;

131 
	}
}

	@isr.c

1 
	~"commÚ.h
"

2 
	~"i¤.h
"

3 
	~"sü“n.h
"

4 
	~"keybßrd.h
"

5 
	~"vm.h
"

6 
	~"tim”.h
"

7 
œq_hªdËr
 
	gœq_¬¿y
[252];

9 
	$©chœqhªdËr
(
œq_hªdËr
 
fun
, 
œq_numb”
)

11 
œq_¬¿y
[
œq_numb”
] = 
fun
;

12 
	}
}

15 
	$i¤_hªdËr
(
»gi¡”s_t
 *
»gs
)

18 if(
œq_¬¿y
[
»gs
->
št_no
] )

20 
œq_hªdËr
 
fun
 = 
œq_¬¿y
[
»gs
->
št_no
];

21 
	`fun
(
»gs
);

24 
	`puts
("recieved unregistered interrupt: ");

25 
	`putšt
(
»gs
->
št_no
);

26 
	`putch
('\n');

27 
	}
}

30 
	$·ge_çuÉ
(
»gi¡”s_t
 *
»gs
)

34 
ušt32
 
çuÉšg_add»ss
;

35 
asm
 vŞ©e("mov %%ü2, %0" : "ô" (
çuÉšg_add»ss
));

38 
´e£Á
 = !(
»gs
->
”r_code
 & 0x1);

39 
rw
 = 
»gs
->
”r_code
 & 0x2;

40 
us
 = 
»gs
->
”r_code
 & 0x4;

41 
»£rved
 = 
»gs
->
”r_code
 & 0x8;

42 
id
 = 
»gs
->
”r_code
 & 0x10;

46 
	`puts
("Page fault! ( ");

47 ià(
´e£Á
è{
	`puts
("page‚ot…resent ");}

48 ià(
rw
è{
	`puts
("read-only ");}

49 ià(
us
è{
	`puts
("user-mode ");}

50 ià(
»£rved
è{
	`puts
("reserved ");}

51 
	`puts
(")‡t 0x");

53 
	`puthex
(
çuÉšg_add»ss
);

54 
	`putch
('\n');

57 
	`puts
("\n");

58 
	`AÎocF¿me
(
çuÉšg_add»ss
, 
NULL
);

59 
	`outb
(0x20, 0x20);

62 
	}
}

64 
	$p™tim”
Ğ
»gi¡”s_t
 *
r
)

67 
	`DoTim”
();

68 
	`outb
(0x20, 0x20);

69 
	}
}

71 
	$doubËçuÉ
Ğ
»gi¡”s_t
 *
r
)

73 
	`puts
("in double fault function\n");

74 
	`outb
(0x20, 0x20);

75 
	}
}

78 
	$keybßrdi¤
Ğ
»gi¡”s_t
 *
r
)

80 
sÿncode
;

83 
sÿncode
 = 
	`šb
(0x60);

87 ià(
sÿncode
 & 0x80)

106 
	`putch
(
kbdus
[
sÿncode
]);

108 
	`outb
(0x20, 0x20);

109 
	}
}

111 
	$š™Ÿlizei¤
()

113 
	`©chœqhªdËr
(&
p™tim”
, 32);

114 
	`©chœqhªdËr
(&
doubËçuÉ
, 8);

115 
	`©chœqhªdËr
(&
keybßrdi¤
, 33);

116 
	`©chœqhªdËr
(&
·ge_çuÉ
, 14);

117 
	}
}

	@main.c

18 
	~"muÉiboÙ.h
"

19 
	~"sü“n.h
"

20 
	~"idt.h
"

21 
	~"ih—p.h
"

22 
	~"vm.h
"

23 
	~"pci.h
"

24 
	~"pci2.h
"

28 
	#CHECK_FLAG
(
æags
,
b™
è((æagsè& (1 << (b™)))

	)

32 
	#COLUMNS
 80

	)

34 
	#LINES
 24

	)

36 
	#ATTRIBUTE
 7

	)

38 
	#VIDEO
 0xB8000

	)

42 
	gxpos
;

44 
	gypos
;

46 vŞ©*
	gvideo
;

50 
şs
 ();

51 
™ß
 (*
buf
, 
ba£
, 
d
);

52 
putch¬
 (
c
);

53 
´štf
 (cÚ¡ *
fÜm©
, ...);

57 
	$maš
 (
magic
, 
addr
)

59 
muÉiboÙ_šfo_t
 *
mbi
;

62 
	`şs
 ();

63 
	`š™Ÿlizeidt
();

64 
	`In™ŸlizePagšg
();

66 
	`SŒobePciDeviûs
();

71 ià(
magic
 !ğ
MULTIBOOT_BOOTLOADER_MAGIC
)

73 
	`´štf
 ("Inv®id magiønumb”: 0x%x\n", (è
magic
);

78 
mbi
 = (
muÉiboÙ_šfo_t
 *è
addr
;

81 
	`´štf
 ("æag ğ0x%x\n", (è
mbi
->
æags
);

84 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 0))

85 
	`´štf
 ("mem_lower = %uKB, mem_upper = %uKB\n",

86 (è
mbi
->
mem_low”
, (èmbi->
mem_uµ”
);

89 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 1))

90 
	`´štf
 ("boÙ_deviû = 0x%x\n", (è
mbi
->
boÙ_deviû
);

93 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 2))

94 
	`´štf
 ("cmdlšğ%s\n", (*è
mbi
->
cmdlše
);

97 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 3))

99 
	`´štf
("flag is set\n");

102 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 3))

104 
muÉiboÙ_moduË_t
 *
mod
;

105 
i
;

107 
š™rd_loÿtiÚ
 = *((*)
mbi
->
mods_addr
);

108 
	`´štf
 ("mods_count = %d, mods_addr = 0x%x\n",

109 (è
mbi
->
mods_couÁ
, (èmbi->
mods_addr
);

111 *
Çme
 = (*è
š™rd_loÿtiÚ
;

113 
	`´štf
("check %d checkii\n", *
Çme
);

114 
i
=0;i<20;i++)

115 
	`´štf
("%ø",
Çme
[
i
]);

116 
i
 = 0, 
mod
 = (
muÉiboÙ_moduË_t
 *è
mbi
->
mods_addr
;

117 
i
 < 
mbi
->
mods_couÁ
;

118 
i
++, 
mod
++)

119 
	`´štf
 (" mod_start = 0x%x, mod_end = 0x%x, cmdline = %s\n",

120 (è
mod
->
mod_¡¬t
,

121 (è
mod
->
mod_’d
,

122 (*è
mod
->
cmdlše
);

126 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 4) && CHECK_FLAG (mbi->flags, 5))

128 
	`´štf
 ("Both bits 4‡nd 5‡re set.\n");

133 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 4))

135 
muÉiboÙ_aout_symbŞ_bË_t
 *
muÉiboÙ_aout_sym
 = &(
mbi
->
u
.
aout_sym
);

137 
	`´štf
 ("multiboot_aout_symbol_table:absize = 0x%0x, "

139 (è
muÉiboÙ_aout_sym
->
bsize
,

140 (è
muÉiboÙ_aout_sym
->
¡rsize
,

141 (è
muÉiboÙ_aout_sym
->
addr
);

145 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 5))

147 
muÉiboÙ_–f_£ùiÚ_h—d”_bË_t
 *
muÉiboÙ_–f_£c
 = &(
mbi
->
u
.
–f_£c
);

149 
	`´štf
 ("multiboot_elf_sec:‚um = %u, size = 0x%x,"

151 (è
muÉiboÙ_–f_£c
->
num
, (èmuÉiboÙ_–f_£c->
size
,

152 (è
muÉiboÙ_–f_£c
->
addr
, (èmuÉiboÙ_–f_£c->
shndx
);

156 ià(
	`CHECK_FLAG
 (
mbi
->
æags
, 6))

158 
muÉiboÙ_memÜy_m­_t
 *
mm­
;

160 
	`´štf
 ("mmap_addr = 0x%x, mmap_length = 0x%x\n",

161 (è
mbi
->
mm­_addr
, (èmbi->
mm­_Ëngth
);

162 
mm­
 = (
muÉiboÙ_memÜy_m­_t
 *è
mbi
->
mm­_addr
;

163 (è
mm­
 < 
mbi
->
mm­_addr
 + mbi->
mm­_Ëngth
;

164 
mm­
 = (
muÉiboÙ_memÜy_m­_t
 *) (() mmap

165 + 
mm­
->
size
 +  (mmap->size)))

166 
	`´štf
 (" size = 0x%x, base_addr = 0x%x%x,"

168 (è
mm­
->
size
,

169 
mm­
->
addr
 >> 32,

170 
mm­
->
addr
 & 0xffffffff,

171 
mm­
->
Ën
 >> 32,

172 
mm­
->
Ën
 & 0xffffffff,

173 (è
mm­
->
ty³
);

175 
	`š™Ÿlizeidt
();

176 
	`In™ŸlizePagšg
();

177 
asm
 volatile("sti");

178 
	}
}

182 
	$şs
 ()

184 
i
;

186 
video
 = (*è
VIDEO
;

188 
i
 = 0; i < 
COLUMNS
 * 
LINES
 * 2; i++)

189 *(
video
 + 
i
) = 0;

191 
xpos
 = 0;

192 
ypos
 = 0;

193 
	}
}

201 
	$putch¬
 (
c
)

203 ià(
c
 == '\n' || c == '\r')

205 
Ãwlše
:

206 
xpos
 = 0;

207 
ypos
++;

208 ià(
ypos
 >ğ
LINES
)

209 
ypos
 = 0;

213 *(
video
 + (
xpos
 + 
ypos
 * 
COLUMNS
è* 2èğ
c
 & 0xFF;

214 *(
video
 + (
xpos
 + 
ypos
 * 
COLUMNS
è* 2 + 1èğ
ATTRIBUTE
;

216 
xpos
++;

217 ià(
xpos
 >ğ
COLUMNS
)

218 
Ãwlše
;

219 
	}
}

	@network.c

1 
	~"pci.h
"

2 
	~"ÃtwÜk.h
"

3 
	~"sü“n.h
"

6 
	$D‘eùRTL8139
()

8 
ušt16
 
v’dÜid
 = 0x10ec;

9 
ušt16
 
deviûid
 = 0x8139;

10 
´e£Á
 = 
	`checkpc™abË
(
deviûid
, 
v’dÜid
);

11 if(
´e£Á
)

13 
	`´štf
(" Detected RTL8139 Network Driver\n");

15 
	}
}

17 
	$D‘eùN‘wÜkDeviûs
()

19 
	`D‘eùRTL8139
();

20 
	}
}

	@pci.c

1 
	~"pci.h
"

2 
	~"commÚ.h
"

3 
	~"sü“n.h
"

4 
	~"ih—p.h
"

5 
	#PCI_DEV_MAX
 0x1F

6 
	#PCI_FUNC_MAX
 0x07

7 

	)

8 
	sPciTabË


10 
ušt16
 
	mDeviûId
;

11 
ušt16
 
	mV’dÜId
;

12 
PciTabË
 *
	mÃxt
;

15 
ušt16
 
	$PciR—dCÚfigWÜd
Ğ
ušt8
 
bus
, ušt8 
dev
, ušt8 
func
, 
ušt16
 
»g
 )

17 
ušt16
 
_cx
 = 0;

18 
ušt8
 
devfunc
 = 0;

21 
dev
 &ğ
PCI_DEV_MAX
;

22 
func
 &ğ
PCI_FUNC_MAX
;

25 
devfunc
 = 
dev
;

26 
devfunc
 <<= 3;

27 
devfunc
 |ğ
func
;

43  
_cx
;

44 
	}
}

46 
PciTabË
 * 
	tPciDeviûs
;

48 
PciDeviûs
 
	gh—d
;

51 
	$checkpc™abË
(
ušt16
 
deviûid
, ušt16 
v’dÜid
)

53 
PciDeviûs
 
‹mp
 = 
h—d
;

54  
‹mp
 !ğ
NULL
 )

56 ifĞ
‹mp
->
DeviûId
 =ğ
deviûid
 &&emp->
V’dÜId
 =ğ
v’dÜid
 )

60 
‹mp
 =emp->
Ãxt
;

63 
	}
}

66 
	$PrštCÏssCode
(
ušt8
 
şasscode
)

68  
şasscode
 )

70 0x00 : 
	`´štf
("Device was built…rior definition ofhe class code field\n");

72 0x01 : 
	`´štf
("Mass Storage Controller\n"); ;

73 0x02 : 
	`´štf
("Network Controller \n"); ;

74 0x03 : 
	`´štf
("Display Controller \n"); ;

75 0x04 : 
	`´štf
("Multimedia Controller \n"); ;

76 0x05 : 
	`´štf
("Memory Controller\n"); ;

77 0x06 : 
	`´štf
("Bridge Device \n"); ;

78 0x07 : 
	`´štf
("Simple Communication Controllers"); ;

79 0x08 : 
	`´štf
("Base System Peripherals\n"); ;

80 0x09 : 
	`´štf
("Input Devices \n"); ;

81 0x0A : 
	`´štf
("Docking Stations \n"); ;

82 0x0B : 
	`´štf
("Processors\n"); ;

83 0x0C : 
	`´štf
("Serial Bus Controllers \n"); ;

84 0x0D : 
	`´štf
("Wireless Controllers \n"); ;

85 0x0E : 
	`´štf
("Intelligent I/O Controllers \n"); ;

86 0x0F : 
	`´štf
("Satellite Communication Controllers \n"); ;

87 0x10 : 
	`´štf
("Encryption/Decryption Controllers \n"); ;

88 0x11 : 
	`´štf
("Data Acquisition‡nd Signal Processing Controllers\n");

90 0xFF : 
	`´štf
("Device does‚ot fit‡ny defined class \n"); ;

92 
	}
}

94 
	$SŒobePciDeviûs
()

96 
i
,
j
;

97 
h—d
 = 
NULL
;

98 
PciDeviûs
 
Ï¡
 = 
NULL
;

99 
i
=0;i<256;i++)

101 
j
=0;j<32;j++)

103 
ušt32
 
R—dWÜd
 = 0;

104 
R—dWÜd
 = R—dWÜd | 
i
 << 16;

105 
R—dWÜd
 = R—dWÜd | 
j
 << 11 | ((
ušt32
)0x80000000);

106 
	`ou
(
R—dWÜd
, 0xCF8);

107 
ušt32
 
»t
 = 
	`šl
(0xCFC);

108 ifĞ(
»t
 & 0xffff) != 0xFFFF )

110 
PciDeviûs
 
‹mp
 = 
	`km®loc
((
PciTabË
));

111 
‹mp
->
V’dÜId
 = 
»t
 & 0xffff;

112 
‹mp
->
DeviûId
 = 
»t
 >> 16 & 0xffff;

113 
‹mp
->
Ãxt
 = 
NULL
;

114 ifĞ
h—d
 =ğ
NULL
 )

116 
h—d
 = 
‹mp
;

120 
Ï¡
->
Ãxt
 = 
‹mp
;

122 
Ï¡
 = 
‹mp
;

123 
	`´štf
("D‘eùed Deviû w™h BusNumb” = %d‡nd DeviûNumb” %d\n",
i
,
j
);

124 
	`´štf
("V’dÜ ID = 0x%x\n", 
»t
 & 0xffff);

125 
	`´štf
("Deviû ID = 0x%x\n", 
»t
 >> 16 & 0xffff);

132 
ušt32
 
»t
 = 
	`šl
(0xCFC);

133 
»t
 = 
	`PciR—dRegi¡”
(
i
,
j
,0x08);

134 
	`´štf
("´šˆ%x\n", 
»t
);

135 
ušt8
 
şasscode
 = 
»t
 >> 24;

136 
	`PrštCÏssCode
(
şasscode
);

138 
ušt32
 
v®
 = 0xffffffff;

143 
ušt32
 
»t2
 = 
	`PciR—dRegi¡”
(
i
,
j
,0x8);

150 
	`´štf
("»ˆv®u%d\n", 
»t2
);

154 
	}
}

156 
ušt32
 
	$PciSŒobeRegi¡”
(
ušt32
 
BusNumb”
, ušt32 
DeviûNumb”
, ušt32 
Regi¡”
)

158 
ušt32
 
R—dWÜd
 = 0;

159 
R—dWÜd
 = R—dWÜd | 
BusNumb”
 << 16;

160 
R—dWÜd
 = R—dWÜd | 
DeviûNumb”
 << 11 | ((
ušt32
)0x80000000);

161 
R—dWÜd
 = 
Regi¡”
 << 2 | ReadWord;

162 
	`ou
(
R—dWÜd
, 0xCF8);

163 
	}
}

164 
ušt32
 
	$PciR—dRegi¡”
(
ušt32
 
BusNumb”
, ušt32 
DeviûNumb”
, ušt32 
Regi¡”
)

166 
ušt32
 
R—dWÜd
 = 0;

167 
R—dWÜd
 = 
BusNumb”
 << 16 | 
Regi¡”
 <<2 | 
DeviûNumb”
 << 11 | ((
ušt32
)0x80000000);

168 
	`ou
(
R—dWÜd
, 0xCF8);

169 
ušt32
 
»t
 = 
	`šl
(0xCFC);

170  
»t
;

171 
	}
}

	@pci2.c

1 
	~"commÚ.h
"

2 
	~"sü“n.h
"

3 
	~"pci2.h
"

5 
ušt8
 
pci_»ad_cÚfig_ušt8
(
ušt16
 
bus
, ušt16 
¦Ù
, ušt16 
func
, ušt16 
»g
);

6 
ušt16
 
pci_»ad_cÚfig_ušt16
(ušt16 
bus
, ušt16 
¦Ù
, ušt16 
func
, ušt16 
»g
);

7 
ušt32
 
pci_»ad_cÚfig_ušt32
(
ušt16
 
bus
, ušt16 
¦Ù
, ušt16 
func
, ušt16 
»g
);

9 
	$pci_sÿn
()

11 
	`´štf
("PCI: Begin scan...\n\n");

12 
ušt16
 
bus
 = 0;

13 
ušt16
 
¦Ù
 = 0;

14 
ušt16
 
v’dÜ
 = 0;

15 
ušt16
 
deviû
 = 0;

21 
v’dÜ
 = 
	`pci_»ad_cÚfig_ušt16
(
bus
, 
¦Ù
, 0, 
PCI_VENDOR
);

22 
deviû
 = 
	`pci_»ad_cÚfig_ušt16
(
bus
, 
¦Ù
, 0, 
PCI_DEVICE
);

23 if(
v’dÜ
 != 0xFFFF)

24 if(
deviû
 != 0xFFFF)

26 
ušt8
 
şass
 = 
	`pci_»ad_cÚfig_ušt8
(
bus
, 
¦Ù
, 0, 
PCI_CLASS
);

27 
ušt8
 
subşass
 = 
	`pci_»ad_cÚfig_ušt8
(
bus
, 
¦Ù
, 0, 
PCI_SUBCLASS
);

28 
ušt8
 
´og_if
 = 
	`pci_»ad_cÚfig_ušt8
(
bus
, 
¦Ù
, 0, 
PCI_PROGIF
);

29 
ušt8
 
»visiÚ
 = 
	`pci_»ad_cÚfig_ušt8
(
bus
, 
¦Ù
, 0, 
PCI_REVISION
);

30 
	`´štf
(" v’dÜ = %x deviû = %x cÏs ğ%x subşas ğ%x\n", 
v’dÜ
, 
deviû
, 
şass
, 
subşass
);

36 
	}
}

38 
ušt8
 
	$pci_»ad_cÚfig_ušt8
(
ušt16
 
bus
, ušt16 
¦Ù
, ušt16 
func
, ušt16 
»g
)

40  (
ušt8
)Ğ(
	`pci_»ad_cÚfig_ušt32
(
bus
, 
¦Ù
, 
func
, 
»g
) >> (8 * (reg & 0x03) ) ) & 0x000000FF );

41 
	}
}

43 
ušt16
 
	$pci_»ad_cÚfig_ušt16
(
ušt16
 
bus
, ušt16 
¦Ù
, ušt16 
func
, ušt16 
»g
)

45  (
ušt16
)Ğ(
	`pci_»ad_cÚfig_ušt32
(
bus
, 
¦Ù
, 
func
, 
»g
) >> (8 * (reg & 0x02) ) ) & 0x0000FFFF );

46 
	}
}

48 
ušt32
 
	$pci_»ad_cÚfig_ušt32
(
ušt16
 
bus
, ušt16 
¦Ù
, ušt16 
func
, ušt16 
»g
)

50 
ušt32
 
add»ss
;

51 
ušt32
 
lbus
 = (ušt32)
bus
;

52 
ušt32
 
l¦Ù
 = (ušt32)
¦Ù
;

53 
ušt32
 
lfunc
 = (ušt32)
func
;

55 
add»ss
 = (
ušt32
)((
lbus
 << 16è| (
l¦Ù
 << 11è| (
lfunc
 << 8è| (
»g
 & 0xfc) | ((uint32)0x80000000));

57 
	`ou
(
PCI_CONFIG_ADDRESS
, 
add»ss
);

58  
	`šl
(
PCI_CONFIG_DATA
);

59 
	}
}

	@pcinet.c

18 
	~<k”Ãl.h
>

19 
	~<ty³s.h
>

20 
	~<pci.h
>

21 
	~<mod.h
>

22 
	~<sk.h
>

23 
	~<fs.h
>

24 
	~<dev.h
>

25 
	#PCI_LOGLEVEL
 1

	)

26 
šode
 *
	g´oc_pci
;

27 vŞ©
	g´oc_pci_maj
;

28 
pci_deviû
 *
	gpci_li¡
=0;

29 
mu‹x_t
 *
	gpci_mu‹x
;

30 
»move_k”Ãl_symbŞ
(* 
uÄes
);

31 
´oc_£t_ÿÎback
(
majÜ
, Ğ*
ÿÎback
)(
rw
, 
šode
 *šode, 
m
, *
buf
));

32 
šode
 *
	`pfs_ú_node
(šod*
to
, *
Çme
, 
mode
, 
majÜ
, 
mšÜ
);

34 
	$pci_add_deviû
(
pci_deviû
 *
dev
)

36 if(!
dev
)  0;

37 
	`mu‹x_Ú
(
pci_mu‹x
);

38 
pci_deviû
 *
tmp
 = 
pci_li¡
;

39 
pci_li¡
 = 
dev
;

40 
dev
->
Ãxt
 = 
tmp
;

41 if(
tmp
)

42 
tmp
->
´ev
=
dev
;

43 
dev
->
´ev
=0;

44 
	`mu‹x_off
(
pci_mu‹x
);

46 
	}
}

49 
	$pci_»move_deviû
(
pci_deviû
 *
dev
)

51 if(!
dev
) ;

52 
	`mu‹x_Ú
(
pci_mu‹x
);

53 if(
dev
->
´ev
)

54 
dev
->
´ev
->
Ãxt
 = dev->next;

55 if(
dev
->
Ãxt
)

56 
dev
->
Ãxt
->
´ev
 = dev->prev;

57 if(
pci_li¡
 =ğ
dev
)

58 
pci_li¡
 = 
dev
->
´ev
 ? dev->´ev : dev->
Ãxt
;

59 
	`kä“
(
dev
->
pcs
);

60 
	`œemove_fÜû
(
dev
->
node
);

61 
	`kä“
(
dev
);

62 
	`mu‹x_off
(
pci_mu‹x
);

63 
	}
}

66 
	$pci_de¡roy_li¡
()

68 
pci_deviû
 *
tmp
 = 
pci_li¡
;

69 
tmp
)

71 
pci_deviû
 *
Ãxt1
 = 
tmp
->
Ãxt
;

72 
	`pci_»move_deviû
(
tmp
);

73 
tmp
=
Ãxt1
;

75 
	}
}

77 cÚ¡ * 
	gşass_code
[13] =

85 cÚ¡ * 
	gsubşass
[13][8] =

103 
	$pci_»ad_cÚfigwÜd
(
bus
, 
¦Ù
, 
func
, 
off£t
)

105 
add»ss
;

106 
lbus
 = ()
bus
;

107 
l¦Ù
 = ()
¦Ù
;

108 
lfunc
 = ()
func
;

109 
tmp
 = 0;

112 
add»ss
 = ()((
lbus
 << 16è| (
l¦Ù
 << 11) |

113 (
lfunc
 << 8è| (
off£t
 & 0xfcè| ((
ušt32_t
)0x80000000));

116 
	`ou
(0xCF8, 
add»ss
);

118 
tmp
 = ()((
	`šl
(0xCFCè>> ((
off£t
 & 2) * 8)) & 0xffff);

119  (
tmp
);

120 
	}
}

122 
ušt32_t
 
	$pci_»ad_dwÜd
(cÚ¡ 
ušt16_t
 
bus
, cÚ¡ ušt16_ˆ
dev
, cÚ¡ ušt16_ˆ
func
, cÚ¡ 
ušt32_t
 
»g
)

124 
	`ou
(0xCF8, 0x80000000L | ((
ušt32_t
)
bus
 << 16è|((ušt32_t)
dev
 << 11) |

125 ((
ušt32_t
)
func
 << 8è| (
»g
 & ~3));

126  
	`šl
(0xCFC + (
»g
 & 3));

127 
	}
}

129 
pci_cÚfig_¥aû
 *
	$g‘_pci_cÚfig
(
bus
, 
dev
, 
func
)

132 
tmp
 = 
	`pci_»ad_dwÜd
(
bus
, 
dev
, 
func
, 0);

133 
v’dÜ
 = (
tmp
 & 0xFFFF);

134 
deviû
 = ((
tmp
 >> 16) & 0xFFFF);

135 
pci_cÚfig_¥aû
 *
pcs
=0;

136 if(
v’dÜ
 && vendor != 0xFFFF) {

140 
pcs
 = (
pci_cÚfig_¥aû
 *)
	`km®loc
((pci_config_space));

141 
i
;

142 
i
=0;i<64;i+=16)

144 *(
ušt32_t
*)((
size_t
)
pcs
 + 
i
èğ
	`pci_»ad_dwÜd
(
bus
, 
dev
, 
func
, i);

145 *(
ušt32_t
*)((
size_t
)
pcs
 + 
i
 + 4èğ
	`pci_»ad_dwÜd
(
bus
, 
dev
, 
func
, i + 4);

146 *(
ušt32_t
*)((
size_t
)
pcs
 + 
i
 + 8èğ
	`pci_»ad_dwÜd
(
bus
, 
dev
, 
func
, i + 8);

147 *(
ušt32_t
*)((
size_t
)
pcs
 + 
i
 + 12èğ
	`pci_»ad_dwÜd
(
bus
, 
dev
, 
func
, i + 12);

149 if(
pcs
->
şass_code
 < 13 &&…cs->
subşass
 != 0x80) {

150 
	`´štk
(
PCI_LOGLEVEL
, "[pci]: [%3.3d:%2.2d:%d] V’dÜ %4.4x, Deviû %4.4x: % %s\n", 
bus
, 
dev
, 
func
, 
pcs
->
v’dÜ_id
,…cs->
deviû_id
, 
subşass
[pcs->
şass_code
][pcs->subclass], class_code[pcs->class_code]);

154  
pcs
;

155 
	}
}

157 
	$pci_sÿn
()

159 
bus
, 
dev
, 
func
, 
tmp
;

160 
bus
=0;bus<256;bus++)

162 
dev
=0;dev<32;dev++)

164 
func
 = 0; func < 8; func++)

166 
pci_cÚfig_¥aû
 *
pcs
=0;

167 
pcs
 = 
	`g‘_pci_cÚfig
(
bus
, 
dev
, 
func
);

168 if(
pcs
) {

170 
pci_deviû
 *
Ãw
 = (pci_deviû *)
	`km®loc
((pci_device));

171 
Ãw
->
bus
=bus;

172 
Ãw
->
dev
=dev;

173 
Ãw
->
func
=func;

174 
Ãw
->
pcs
=pcs;

175 
	`pci_add_deviû
(
Ãw
);

176 
Çme
[64];

177 
mš
=0;

178 
mš
 = 256*
bus
 + 
dev
*8 + 
func
;

179 
	`¥rštf
(
Çme
, "%x.%x.%x", 
bus
, 
dev
, 
func
);

180 if(
´oc_pci_maj
è(
Ãw
->
node
=
	`pfs_ú_node
(
´oc_pci
, 
Çme
, 
S_IFREG
,…roc_pci_maj, 
mš
));

181 if(
Ãw
->
node
)

182 
Ãw
->
node
->
Ën
=(
pci_deviû
);

187 
	}
}

190 
pci_deviû
 *
	$pci_loÿ‹_deviû
(
v’dÜ
, 
deviû
)

192 if(
v’dÜ
 =ğ0xFFFF || 
deviû
 == 0xFFFF)

194 
pci_deviû
 *
tmp
 = 
pci_li¡
;

195 
tmp
)

197 if(
tmp
->
pcs
->
v’dÜ_id
 =ğ
v’dÜ
 &&mp->pcs->
deviû_id
 =ğ
deviû
)

198  
tmp
;

199 
tmp
ñmp->
Ãxt
;

202 
	}
}

205 
pci_deviû
 *
	$pci_loÿ‹_deviûs
(
v’dÜ
, 
deviû
, 
i
)

207 if(
v’dÜ
 =ğ0xFFFF || 
deviû
 == 0xFFFF)

209 
pci_deviû
 *
tmp
 = 
pci_li¡
;

210 
tmp
)

212 if(!
i
 && 
tmp
->
pcs
->
v’dÜ_id
 =ğ
v’dÜ
 &&mp->pcs->
deviû_id
 =ğ
deviû
)

213  
tmp
;

214 
tmp
ñmp->
Ãxt
;

215 
i
--;

218 
	}
}

220 
pci_deviû
 *
	$pci_loÿ‹_şass
(
şass
, 
_subşass
)

222 if(
şass
 =ğ0xFFFF || 
_subşass
 == 0xFFFF)

224 
pci_deviû
 *
tmp
 = 
pci_li¡
;

225 
tmp
)

227 if(
tmp
->
pcs
->
şass_code
 =ğ
şass
 &&mp->pcs->
subşass
 =ğ
_subşass
)

228  
tmp
;

229 
tmp
ñmp->
Ãxt
;

232 
	}
}

234 
	$pci_g‘_ba£_add»ss
(
pci_deviû
 *
deviû
)

236 
size_t
 
tmp
, 
i
;

238 
i
 = 0; i < 6; i++)

240 if(*(
ušt32_t
*)(&
deviû
->
pcs
->
b¬0
 + 
i
));

242 if(
i
 >= 6)

244 
tmp
 = *(
ušt32_t
*)(&
deviû
->
pcs
->
b¬0
 + 
i
);

245 if(
deviû
->
pcs
->
v’dÜ_id
 == 0x0000 || device->pcs->vendor_id == 0xFFFF)

247 
	`k´štf
("PCI: Inv®id cÚfigu¿tiÚ s·û fÜ g‘_ba£_add»ss(èš [%3.3d:%2.2d:%d]\n", 
deviû
->
bus
, deviû->
dev
, deviû->
func
);

252 if(!(
tmp
 & 0x01))

253  
tmp
 & 0xFFFFFFF0;

256  
tmp
 & 0xFFFFFFFC;

257 
	}
}

259 
	$pci_´oc_ÿÎ
(
rw
, 
šode
 *šode, 
m
, *
buf
)

261 if(
rw
 =ğ
READ
)

263 
bus
, 
dev
, 
func
;

264 
bus
 = 
m
 / 256;

265 
dev
 = (
m
 % 256) / 8;

266 
func
 = (
m
 % 256) % 8;

267 
pci_deviû
 *
tmp
 = 
pci_li¡
;

268 
tmp
)

270 if(
tmp
->
bus
 =ğbu &&mp->
dev
 =ğdev &&mp->
func
 == func)

272 
tmp
ñmp->
Ãxt
;

274 if(
tmp
) {

275 
	`memıy
(
buf
, (*)
tmp
, (
pci_deviû
));

280 
	}
}

282 
	$moduË_š¡®l
()

284 
pci_li¡
=0;

285 
pci_mu‹x
 = 
	`ü—‹_mu‹x
(0);

286 
´oc_pci_maj
 = 
	`´oc_g‘_majÜ
();

287 
´oc_pci
=
	`pfs_ú
("pci", 
S_IFDIR
, 
´oc_pci_maj
, 0);

288 
	`´oc_£t_ÿÎback
(
´oc_pci_maj
, 
pci_´oc_ÿÎ
);

289 
	`´štk
(1, "[pci]: Scanning…ci bus\n");

290 
	`pci_sÿn
();

292 
	`add_k”Ãl_symbŞ
(
pci_loÿ‹_deviû
);

293 
	`add_k”Ãl_symbŞ
(
pci_loÿ‹_deviûs
);

294 
	`add_k”Ãl_symbŞ
(
pci_loÿ‹_şass
);

295 
	`add_k”Ãl_symbŞ
(
pci_g‘_ba£_add»ss
);

298 
	}
}

300 
	$moduË_ex™
()

302 
	`pci_de¡roy_li¡
();

303 
	`de¡roy_mu‹x
(
pci_mu‹x
);

304 
	`œemove_fÜû
(
´oc_pci
);

305 
	`´oc_£t_ÿÎback
(
´oc_pci_maj
, 0);

306 
	`»move_k”Ãl_symbŞ
("pci_locate_device");

307 
	`»move_k”Ãl_symbŞ
("pci_locate_devices");

308 
	`»move_k”Ãl_symbŞ
("pci_locate_class");

309 
	`»move_k”Ãl_symbŞ
("pci_get_base_address");

311 
	}
}

312 
	$moduË_d•s
(*
b
)

314  
KVERSION
;

315 
	}
}

	@screen.c

1 
	~"commÚ.h
"

2 
	~"sü“n.h
"

3 
	gCu¼’tDebugLev–
 = 0;

4 
ušt16
 *
	gvideo
 = (uint16 *) 0xB8000;

5 
ušt32
 
	gsü“nx
 = 0;

6 
ušt32
 
	gsü“ny
 = 0;

7 
	#SCREENWIDTH
 80

	)

8 
	#SCREENLENGTH
 25

	)

9 
	#CursÜBlškF»qu’cy
 5

	)

11 
	$BlškCursÜ
()

13 
ušt32
 
couÁ”
 = 0;

14 ifĞ
couÁ”
 =ğ
CursÜBlškF»qu’cy
)

15 
	`D–‘eCursÜ
();

16 ifĞ
couÁ”
 >ğ2*
CursÜBlškF»qu’cy
)

18 
	`ShowCursÜ
();

19 
couÁ”
 = 0;

21 
couÁ”
 ++;

22 
	}
}

24 
	$S‘Cu¼’tDebugLev–
(
ÃwËv–
)

26 
Cu¼’tDebugLev–
 = 
ÃwËv–
;

27 
	}
}

30 
	$süŞl
(
Ën
)

32 
i
,
j
;

33 
sü“Åos
 = 0;

34 
ušt16
 
sü“nv®ue
 = 0;

35 
ušt8
 
background
 = 0;

36 
ušt8
 
fÜeground
 = 7;

37 
i
=0;i<
SCREENLENGTH
 - 
Ën
;i++){

38 
j
=0;j<
SCREENWIDTH
;j++){

39 
video
[
sü“Åos
] = video[sü“Åo + 
Ën
*
SCREENWIDTH
];

40 
sü“Åos
++;

43 
i
=
SCREENLENGTH
 -
Ën
;i<SCREENLENGTH;i++){

44 
j
=0;j<
SCREENWIDTH
;j++){

45 
sü“nv®ue
 = 
background
<<12;

46 
sü“nv®ue
 = sü“nv®u| 
fÜeground
<<8;

47 
sü“nv®ue
 = screenvalue | 32;

48 
video
[
sü“Åos
] = 
sü“nv®ue
;

49 
sü“Åos
++;

52 
sü“nx
 = 0;

53 
sü“ny
 = 
SCREENLENGTH
 - 
Ën
;

54 
	}
}

57 
	$ShowCursÜ
()

59 
sü“Åos
 = 
sü“nx
 + 
sü“ny
*
SCREENWIDTH
;

60 
ušt16
 
sü“nv®ue
 = 0;

61 
ušt8
 
background
 = 2;

62 
ušt8
 
fÜeground
 = 9;

63 
sü“nv®ue
 = 
background
<<12;

64 
sü“nv®ue
 = sü“nv®u| 
fÜeground
<<8;

65 
sü“nv®ue
 = screenvalue | '_';

66 
video
[
sü“Åos
] = 
sü“nv®ue
;

67 
	}
}

69 
	$D–‘eCursÜ
()

71 
sü“Åos
 = 
sü“nx
 + 
sü“ny
*
SCREENWIDTH
;

72 
ušt16
 
sü“nv®ue
 = 0;

73 
ušt8
 
background
 = 0;

74 
ušt8
 
fÜeground
 = 7;

75 
sü“nv®ue
 = 
background
<<12;

76 
sü“nv®ue
 = sü“nv®u| 
fÜeground
<<8;

77 
sü“nv®ue
 = screenvalue | 32;

78 
video
[
sü“Åos
] = 
sü“nv®ue
;

79 
	}
}

81 
	$putch
(
ch
)

83 ifĞ
sü“ny
 =ğ
SCREENLENGTH
 )

84 
	`süŞl
(1);

85 
sü“Åos
 = 
sü“nx
 + 
sü“ny
*
SCREENWIDTH
;

86 
ušt16
 
sü“nv®ue
 = 0;

87 
ušt8
 
background
 = 0;

88 
ušt8
 
fÜeground
 = 7;

89 
sü“nv®ue
 = 
background
<<12;

90 
sü“nv®ue
 = sü“nv®u| 
fÜeground
<<8;

91 if(
ch
 == 40 )

93 
sü“nv®ue
 = screenvalue | 32;

94 
video
[
sü“Åos
] = 
sü“nv®ue
;

95 
sü“nx
 = 0;

96 
sü“ny
++;

99 if(
ch
 == 8 )

101 
sü“nv®ue
 = screenvalue | 32;

102 
video
[
sü“Åos
] = 
sü“nv®ue
;

103 ifĞ
sü“nx
 > 1)

104 
sü“nx
--;

107 
sü“ny
--;

108 
sü“nx
 = 
SCREENWIDTH
;

112 if(
ch
 == 10 )

114 
sü“nv®ue
 = screenvalue | 32;

115 
video
[
sü“Åos
] = 
sü“nv®ue
;

116 
sü“nx
 = 0;

117 
sü“ny
++;

120 
sü“nv®ue
 = sü“nv®u| 
ch
;

121 
video
[
sü“Åos
] = 
sü“nv®ue
;

122 
sü“nx
++;

123 if(
sü“nx
 > 
SCREENWIDTH
 ){

124 
sü“nx
 = 1;

125 
sü“ny
++;

127 
	}
}

129 
	$şr
()

131 
i
,
j
;

132 
sü“nx
 = 0;

133 
sü“ny
 = 0;

134 
i
=0;i<
SCREENLENGTH
;i++){

135 
j
=0;j<
SCREENWIDTH
;j++){

136 
	`putch
(32);

139 
sü“nx
 = 0;

140 
sü“ny
 = 0;

141 
	}
}

143 
	$puts
(*
¡r
)

145 
i
 = 0;

146 
¡r
[
i
]!='\0'){

147 
	`putch
(
¡r
[
i
]);

148 
i
++;

150 
	}
}

152 
	$»v”£št
(
num
)

154 
‹mp
 = 0 ;

155 
num
)

157 
‹mp
 =em°+ 
num
 % 10;

158 
‹mp
 =emp * 10;

159 
num
 =‚um / 10;

161  
‹mp
/10;

162 
	}
}

164 
	$putšt
(
num
)

166 
i
 = 0,
j
;

167 
¬r
[30];

168 ifĞ
num
 == 0 )

170 
	`putch
('0');

172  
num
 )

174 
¬r
[
i
] = 
num
%10 + 48;

175 
i
++;

176 
num
 =‚um/10;

178 
j
=
i
-1;j>=0;j--)

180 
	`putch
(
¬r
[
j
]);

182 
	}
}

184 
	$puthex
(
ušt32
 
num
)

186 
a
, 
i
 = 0, 
j
;

187 
¡r
[32];

188 
ch
;

189 
num
)

191 
a
 = 
num
%16;

192 if(
a
>=10)

194 
ch
 = 'a' + 
a
-10;

195 
¡r
[
i
] = 
ch
;

199 
ch
 = '0' + 
a
 ;

200 
¡r
[
i
] = 
ch
;

202 
num
 =‚um/16;

203 
i
++;

205 
j
=0;j<
i
;j++)

207 
	`putch
(
¡r
[
i
-
j
-1]);

209 
	}
}

211 
	$™ß
 (*
buf
, 
ba£
, 
d
)

213 *
p
 = 
buf
;

214 *
p1
, *
p2
;

215 
ud
 = 
d
;

216 
divisÜ
 = 10;

219 ià(
ba£
 =ğ'd' && 
d
 < 0)

221 *
p
++ = '-';

222 
buf
++;

223 
ud
 = -
d
;

225 ià(
ba£
 == 'x')

226 
divisÜ
 = 16;

231 
»mašd”
 = 
ud
 % 
divisÜ
;

233 *
p
++ = (
»mašd”
 < 10) ?„emainder + '0' :„emainder + 'a' - 10;

235 
ud
 /ğ
divisÜ
);

238 *
p
 = 0;

241 
p1
 = 
buf
;

242 
p2
 = 
p
 - 1;

243 
p1
 < 
p2
)

245 
tmp
 = *
p1
;

246 *
p1
 = *
p2
;

247 *
p2
 = 
tmp
;

248 
p1
++;

249 
p2
--;

251 
	}
}

253 
	$´štk
(
Ëv–
, * 
mes§ge
)

255 ifĞ
Ëv–
 >ğ
Cu¼’tDebugLev–
 )

257 
	`puts
(
mes§ge
);

259 
	}
}

261 
	$´štf
 (cÚ¡ *
fÜm©
, ...)

263 **
¬g
 = (**è&
fÜm©
;

264 
c
;

265 
buf
[20];

267 
¬g
++;

269 (
c
 = *
fÜm©
++) != 0)

271 ià(
c
 != '%')

272 
	`putch
 (
c
);

275 *
p
;

277 
c
 = *
fÜm©
++;

278 
c
)

283 
	`™ß
 (
buf
, 
c
, *((*è
¬g
++));

284 
p
 = 
buf
;

285 
¡ršg
;

289 
p
 = *
¬g
++;

290 ià(! 
p
)

291 
p
 = "(null)";

293 
¡ršg
:

294 *
p
)

295 
	`putch
 (*
p
++);

299 
	`putch
 (*((*è
¬g
++));

304 
	}
}

	@test.c

1 
	gnşude
 <
	g¡ddef
.
	gh
>

2 
	~<´št.h
>

3 
	~<¡ršg.h
>

4 
	~<io.h
>

5 
	~<time.h
>

9 
dwÜd
 *
	gSMI_CMD
;

10 
by‹
 
	gACPI_ENABLE
;

11 
by‹
 
	gACPI_DISABLE
;

12 
dwÜd
 *
	gPM1a_CNT
;

13 
dwÜd
 *
	gPM1b_CNT
;

14 
wÜd
 
	gSLP_TYPa
;

15 
wÜd
 
	gSLP_TYPb
;

16 
wÜd
 
	gSLP_EN
;

17 
wÜd
 
	gSCI_EN
;

18 
by‹
 
	gPM1_CNT_LEN
;

22 
	sRSDPŒ


24 
by‹
 
	mSigÇtu»
[8];

25 
by‹
 
	mCheckSum
;

26 
by‹
 
	mOemID
[6];

27 
by‹
 
	mRevisiÚ
;

28 
dwÜd
 *
	mRsdtAdd»ss
;

33 
	sFACP


35 
by‹
 
	mSigÇtu»
[4];

36 
dwÜd
 
	mL’gth
;

37 
by‹
 
	muÂeded1
[40 - 8];

38 
dwÜd
 *
	mDSDT
;

39 
by‹
 
	muÂeded2
[48 - 44];

40 
dwÜd
 *
	mSMI_CMD
;

41 
by‹
 
	mACPI_ENABLE
;

42 
by‹
 
	mACPI_DISABLE
;

43 
by‹
 
	muÂeded3
[64 - 54];

44 
dwÜd
 *
	mPM1a_CNT_BLK
;

45 
dwÜd
 *
	mPM1b_CNT_BLK
;

46 
by‹
 
	muÂeded4
[89 - 72];

47 
by‹
 
	mPM1_CNT_LEN
;

53 *
	$aıiCheckRSDPŒ
(*
±r
)

55 *
sig
 = "RSD PTR ";

56 
RSDPŒ
 *
rsdp
 = (RSDPŒ *è
±r
;

57 
by‹
 *
b±r
;

58 
by‹
 
check
 = 0;

59 
i
;

61 ià(
	`memcmp
(
sig
, 
rsdp
, 8) == 0)

64 
b±r
 = (
by‹
 *è
±r
;

65 
i
=0; i<(
RSDPŒ
); i++)

67 
check
 +ğ*
b±r
;

68 
b±r
++;

72 ià(
check
 == 0) {

79  (*è
rsdp
->
RsdtAdd»ss
;

83  
NULL
;

84 
	}
}

89 *
	$aıiG‘RSDPŒ
()

91 *
addr
;

92 *
rsdp
;

95 
addr
 = (*) 0x000E0000; ()‡ddr<0x00100000;‡ddr += 0x10/(addr))

97 
rsdp
 = 
	`aıiCheckRSDPŒ
(
addr
);

98 ià(
rsdp
 !ğ
NULL
)

99  
rsdp
;

104 
ebda
 = *((*) 0x40E);

105 
ebda
 =ƒbda*0x10 &0x000FFFFF;

108 
addr
 = (*è
ebda
; ()‡ddr<ebda+1024;‡ddr+= 0x10/(addr))

110 
rsdp
 = 
	`aıiCheckRSDPŒ
(
addr
);

111 ià(
rsdp
 !ğ
NULL
)

112  
rsdp
;

115  
NULL
;

116 
	}
}

121 
	$aıiCheckH—d”
(*
±r
, *
sig
)

123 ià(
	`memcmp
(
±r
, 
sig
, 4) == 0)

125 *
checkPŒ
 = (*è
±r
;

126 
Ën
 = *(
±r
 + 1);

127 
check
 = 0;

128 0<
Ën
--)

130 
check
 +ğ*
checkPŒ
;

131 
checkPŒ
++;

133 ià(
check
 == 0)

137 
	}
}

141 
	$aıiEÇbË
()

144 iàĞ(
	`šw
((è
PM1a_CNT
è&
SCI_EN
) == 0 )

147 ià(
SMI_CMD
 !ğ0 && 
ACPI_ENABLE
 != 0)

149 
	`outb
((è
SMI_CMD
, 
ACPI_ENABLE
);

151 
i
;

152 
i
=0; i<300; i++ )

154 iàĞ(
	`šw
((è
PM1a_CNT
è&
SCI_EN
) == 1 )

156 
	`¦“p
(10);

158 ià(
PM1b_CNT
 != 0)

159 ; 
i
<300; i++ )

161 iàĞ(
	`šw
((è
PM1b_CNT
è&
SCI_EN
) == 1 )

163 
	`¦“p
(10);

165 ià(
i
<300) {

166 
	`wr¡r
("enabled‡cpi.\n");

169 
	`wr¡r
("couldn'tƒnable‡cpi.\n");

173 
	`wr¡r
("no known wayoƒnable‡cpi.\n");

180 
	}
}

202 
	$š™Aıi
()

204 *
±r
 = 
	`aıiG‘RSDPŒ
();

207 ià(
±r
 !ğ
NULL
 && 
	`aıiCheckH—d”
(ptr, "RSDT") == 0)

210 
’Œys
 = *(
±r
 + 1);

211 
’Œys
 = (entrys-36) /4;

212 
±r
 += 36/4;

214 0<
’Œys
--)

217 ià(
	`aıiCheckH—d”
((*è*
±r
, "FACP") == 0)

219 
’Œys
 = -2;

220 
FACP
 *
çı
 = (FACP *è*
±r
;

221 ià(
	`aıiCheckH—d”
((*è
çı
->
DSDT
, "DSDT") == 0)

224 *
S5Addr
 = (*è
çı
->
DSDT
 +36;

225 
dsdtL’gth
 = *(
çı
->
DSDT
+1) -36;

226 0 < 
dsdtL’gth
--)

228 iàĞ
	`memcmp
(
S5Addr
, "_S5_", 4) == 0)

230 
S5Addr
++;

233 ià(
dsdtL’gth
 > 0)

236 iàĞĞ*(
S5Addr
-1) == 0x08 || ( *(S5Addr-2) == 0x08 && *(S5Addr-1) == '\\') ) && *(S5Addr+4) == 0x12 )

238 
S5Addr
 += 5;

239 
S5Addr
 += ((*S5Addr &0xC0)>>6) +2;

241 ià(*
S5Addr
 == 0x0A)

242 
S5Addr
++;

243 
SLP_TYPa
 = *(
S5Addr
)<<10;

244 
S5Addr
++;

246 ià(*
S5Addr
 == 0x0A)

247 
S5Addr
++;

248 
SLP_TYPb
 = *(
S5Addr
)<<10;

250 
SMI_CMD
 = 
çı
->SMI_CMD;

252 
ACPI_ENABLE
 = 
çı
->ACPI_ENABLE;

253 
ACPI_DISABLE
 = 
çı
->ACPI_DISABLE;

255 
PM1a_CNT
 = 
çı
->
PM1a_CNT_BLK
;

256 
PM1b_CNT
 = 
çı
->
PM1b_CNT_BLK
;

258 
PM1_CNT_LEN
 = 
çı
->PM1_CNT_LEN;

260 
SLP_EN
 = 1<<13;

261 
SCI_EN
 = 1;

265 
	`wr¡r
("\\_S5…arseƒrror.\n");

268 
	`wr¡r
("\\_S5‚ot…resent.\n");

271 
	`wr¡r
("DSDT invalid.\n");

274 
±r
++;

276 
	`wr¡r
("no valid FACP…resent.\n");

278 
	`wr¡r
("no‡cpi.\n");

282 
	}
}

286 
	$aıiPow”Off
()

289 ià(
SCI_EN
 == 0)

292 
	`aıiEÇbË
();

295 
	`outw
((è
PM1a_CNT
, 
SLP_TYPa
 | 
SLP_EN
 );

296 iàĞ
PM1b_CNT
 != 0 )

297 
	`outw
((è
PM1b_CNT
, 
SLP_TYPb
 | 
SLP_EN
 );

299 
	`wr¡r
("acpi…oweroff failed.\n");

300 
	}
}

	@timer.c

1 
	~"commÚ.h
"

2 
	~"tim”.h
"

3 
	~"sü“n.h
"

4 
	$DoTim”
()

11 
	`BlškCursÜ
();

13 
	}
}

	@vm.c

1 
	~"vm.h
"

2 
	~"commÚ.h
"

3 
	#M®locH—pSize
 1024*1024*50

	)

4 
’d
;

5 
ušt32
 
¶aûm’t_add»ss
;

6 
	gTOTAL_PHYSICAL_MEMORY
 = 0x10000000;

7 
ušt32
 
KM®locS¹šgAdd»ss
;

8 
ušt32
 
KM®locSize
;

9 
	gF¿mes
[0x10000];

10 
	$G‘F»eF¿me
(*
šdex
, *
b™pos
)

12 
MaximumIndex
 = 
TOTAL_PHYSICAL_MEMORY
/0x1000;

13 
i
 = 0, 
j
;

14 
i
<
MaximumIndex
)

16 if(
F¿mes
[
i
]^0xff)

18 
a
 = 
F¿mes
[
i
];

19 
j
=0;j<8;j++)

21 if((
a
&0x01) == 0)

23 *
šdex
 = 
i
;

24 *
b™pos
 = 
j
;

27 
a
 =‡/2;

30 
i
++;

33 
	}
}

35 
	$S‘F¿me
(
šdex
, 
b™pos
)

37 
n
 = 1;

38 
i
;

39 
i
=0;i<
b™pos
;i++)

41 
n
 =‚*2;

43 
F¿mes
[
šdex
] = F¿mes[šdex] | 
n
;

44 
	}
}

46 
	$G‘F¿me
Ğ
ušt32
 *
äam—dd»ss
)

48 
šdex
, 
pos
;

49 
	`G‘F»eF¿me
(&
šdex
, &
pos
);

50 
	`S‘F¿me
(
šdex
, 
pos
);

51 
äam—dd»ss
 = 
šdex
*8 + 
pos
;

52 
	}
}

54 
	$F»eF¿me
(
ušt32
 
äame
)

56 
šdex
 = 
äame
/(0x1000 * 8);

57 
pos
 = 
äame
 % ( 0x1000 * 8);

58 
F¿mes
[
šdex
] = F¿mes[šdex] & (~ (1<<
pos
));

59 
	}
}

63 
v·ge_t
 *
	$G‘Page
(
ušt32
 
add»ss
, 
v·gedœ_t
 *
dœ
)

65 
v·ge_t
 *
»tuºadd»ss
 = 
NULL
;

66 if(
dœ
 =ğ
NULL
 )

67 
dœ
 = 
wÜkšg_·ge_dœeùÜy
;

68 
add»ss
 =‡ddress / 0x1000;

69 
ušt32
 
bËšdex
 = 
add»ss
 / 1024;

70 
ušt32
 
·gešdex
 = 
add»ss
 % 1024;

78 ifĞ
NULL
 !ğ
dœ
->
bËs
[
bËšdex
] )

80 
»tuºadd»ss
 = &(
dœ
->
bËs
[
bËšdex
]->
·ges
[
·gešdex
]);

84 
	`´štk
(3, "creating‚ew…ageable\n");

85 
v·g‘abË_t
 *
±abË
 = (v·g‘abË_ˆ*)
	`im®loc
((
v·ge_t
));

86 
	`mem£t
(
±abË
, 0, (
v·g‘abË_t
));

87 
dœ
->
bËs
[
bËšdex
] = 
±abË
;

88 
dœ
->
physiÿl
[
bËšdex
] = (
v·gedœ_t
 *)((
ušt32
è
±abË
 | 0x7);

89 
»tuºadd»ss
 = &(
±abË
->
·ges
[
·gešdex
]);

91 
v·ge_t
 *
·ge
 = (v·ge_t*è
»tuºadd»ss
;

92 
·ge
->
´e£Á
 = 0;

93 
·ge
->
rw
 = 0;

94 
·ge
->
u£r
 = 0;

95  
»tuºadd»ss
;

96 
	}
}

99 
	$AÎocF¿me
(
ušt32
 
add»ss
, 
v·gedœ_t
 *
dœ
)

102 
	`´štk
(2, "In AllocFrame\n");

103 ifĞ
dœ
 =ğ
NULL
)

105 
dœ
 = 
wÜkšg_·ge_dœeùÜy
;

107 
v·ge_t
 *
·ge
 = (v·ge_t*è
	`G‘Page
(
add»ss
, 
dœ
);

111 
	`buzywa™
(10);

112 
ušt32
 
F¿me
;

113 
	`G‘F¿me
(&
F¿me
);

114 
·ge
->
äame
 = 
F¿me
;

115 
·ge
->
´e£Á
 = 1;

116 
·ge
->
rw
 = 1;

117 
·ge
->
u£r
 = 1;

118 
	}
}

120 
	$In™ŸlizePagšg
()

122 
v·gedœ_t
 *
k”Ãl_dœeùÜy
 = (v·gedœ_ˆ*)
	`im®loc
((vpagedir_t));

123 
	`mem£t
(
k”Ãl_dœeùÜy
, 0, (
v·gedœ_t
));

124 
x
 = 0;

125 
Ï¡
 = -1;

126 
x
<
¶aûm’t_add»ss
 + 
M®locH—pSize
)

128 
add
 = 
x
/0x1000;

129 
šdj
 = 
add
/1024;

130 
v·g‘abË_t
 *
±abË
;

131 ifĞ
Ï¡
 !ğ
šdj
 )

133 
±abË
 = (
v·g‘abË_t
 *)
	`im®loc
((vpagetable_t));

134 
	`mem£t
(
±abË
, 0, (
v·g‘abË_t
));

135 
k”Ãl_dœeùÜy
->
bËs
[
šdj
] = 
±abË
;

136 
k”Ãl_dœeùÜy
->
physiÿl
[
šdj
] = (
v·gedœ_t
 *)((
ušt32
è
±abË
 | 0x7);

137 
Ï¡
 = 
šdj
;

139 
šdi
 = 
add
%1024;

140 
v·ge_t
 *
·ge
 = (v·ge_t*)&
±abË
->
·ges
[
šdi
];

141 
ušt32
 
num
 = 0;

142 
·ge
->
äame
 = 
num
;

143 
	`S‘F¿me
(
num
/8,‚um%8);

144 
num
++;

145 
·ge
->
´e£Á
 = 1;

146 
·ge
->
rw
 = 0;

147 
·ge
->
u£r
 = 0;

148 
x
 = x + 0x1000;

150 
i
;

151 
KM®locS¹šgAdd»ss
 = 
¶aûm’t_add»ss
 + 0x3000;

152 
i
=
KM®locS¹šgAdd»ss
; i<
KM®locSize
; i = i + 0x1000)

156 
	`G‘Page
(
i
, 
NULL
);

158 
	`chªgePagedœ
(
k”Ãl_dœeùÜy
);

159 
	}
}

161 
	$chªgePagedœ
(
v·gedœ_t
 *
dœ
)

163 
wÜkšg_·ge_dœeùÜy
 = 
dœ
;

165 
asm
 vŞ©e("mov %0, %%ü3":: "r"(&
wÜkšg_·ge_dœeùÜy
->
physiÿl
));

166 
ušt32
 
ü0
;

167 
asm
 vŞ©e("mov %%ü0, %0": "ô"(
ü0
));

168 
ü0
 |= 0x80000000;

169 
asm
 vŞ©e("mov %0, %%ü0":: "r"(
ü0
));

170 
	}
}

	@/usr/include/string.h

24 #iâdef 
_STRING_H


25 
	#_STRING_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 
__BEGIN_NAMESPACE_STD


44 *
	$memıy
 (*
__»¡riù
 
__de¡
,

45 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

46 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

49 *
	$memmove
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
)

50 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

51 
__END_NAMESPACE_STD


56 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


57 *
	$memcıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

58 
__c
, 
size_t
 
__n
)

59 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

63 
__BEGIN_NAMESPACE_STD


65 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

68 
	$memcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

72 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


75 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

76 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 
__cÚ¡
 *
	`memchr
 (__cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

80 #ifdeà
__OPTIMIZE__


81 
__ex‹º_®ways_šlše
 *

82 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


84  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

87 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

88 
	`memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


90  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

93 
	}
}

95 *
	$memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

96 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

98 
__END_NAMESPACE_STD


100 #ifdeà
__USE_GNU


103 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


104 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

105 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 "C++" 
__cÚ¡
 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

107 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

109 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

110 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 "C++" 
__cÚ¡
 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

120 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

126 
__BEGIN_NAMESPACE_STD


128 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

129 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

131 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

132 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

133 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

137 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

139 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

140 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
	$¡ºcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

147 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
	$¡rcŞl
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

153 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

154 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

155 
__THROW
 
	`__nÚnuÎ
 ((2));

156 
__END_NAMESPACE_STD


158 #ifdeà
__USE_XOPEN2K8


162 
	~<xloÿË.h
>

165 
	$¡rcŞl_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

166 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

168 
size_t
 
	$¡rxäm_l
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
,

169 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

172 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

173 || 
defšed
 
__USE_XOPEN2K8


175 *
	$¡rdup
 (
__cÚ¡
 *
__s
)

176 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

182 #ià
defšed
 
__USE_XOPEN2K8


183 *
	$¡ºdup
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__n
)

184 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

187 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


189 
	#¡rdu·
(
s
) \

190 (
__ex‹nsiÚ__
 \

192 
__cÚ¡
 *
__Şd
 = (
s
); \

193 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

194 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

195 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

196 
	}
}))

	)

199 
	#¡ºdu·
(
s
, 
n
) \

200 (
__ex‹nsiÚ__
 \

202 
__cÚ¡
 *
__Şd
 = (
s
); \

203 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

204 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

205 
__Ãw
[
__Ën
] = '\0'; \

206 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

207 }))

	)

210 
	g__BEGIN_NAMESPACE_STD


212 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


215 *
¡rchr
 (*
__s
, 
__c
)

216 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

217 
__cÚ¡
 *
¡rchr
 (__cÚ¡ *
__s
, 
__c
)

218 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

220 #ifdeà
__OPTIMIZE__


221 
__ex‹º_®ways_šlše
 *

222 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


224  
__butš_¡rchr
 (
__s
, 
__c
);

227 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

228 
¡rchr
 (
__cÚ¡
 *
__s
, 
__c
è
	g__THROW


230  
__butš_¡rchr
 (
__s
, 
__c
);

235 *
	$¡rchr
 (
__cÚ¡
 *
__s
, 
__c
)

236 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

239 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


242 *
	`¡¼chr
 (*
__s
, 
__c
)

243 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

244 
__cÚ¡
 *
	`¡¼chr
 (__cÚ¡ *
__s
, 
__c
)

245 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

247 #ifdeà
__OPTIMIZE__


248 
__ex‹º_®ways_šlše
 *

249 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


251  
	`__butš_¡¼chr
 (
__s
, 
__c
);

254 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

255 
	`¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


257  
	`__butš_¡¼chr
 (
__s
, 
__c
);

260 
	}
}

262 *
	$¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
)

263 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 
__END_NAMESPACE_STD


267 #ifdeà
__USE_GNU


270 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


271 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

272 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

273 "C++" 
__cÚ¡
 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

274 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

276 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

281 
__BEGIN_NAMESPACE_STD


284 
size_t
 
	$¡rc¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__»jeù
)

285 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

288 
size_t
 
	$¡r¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

289 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

291 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


294 *
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
)

295 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

296 
__cÚ¡
 *
	`¡½brk
 (__cÚ¡ *
__s
, __cÚ¡ *
__acû±
)

297 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

299 #ifdeà
__OPTIMIZE__


300 
__ex‹º_®ways_šlše
 *

301 
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
è
__THROW


303  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

306 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

307 
	`¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
è
__THROW


309  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

312 
	}
}

314 *
	$¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

318 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


321 *
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

322 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

323 
__cÚ¡
 *
	`¡r¡r
 (__cÚ¡ *
__hay¡ack
,

324 
__cÚ¡
 *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
è
__THROW


331  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

335 
	`¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
è
__THROW


337  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 
__cÚ¡
 *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" 
__cÚ¡
 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
,

370 
__cÚ¡
 *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (
__cÚ¡
 *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 
__cÚ¡
 *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

389 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

392 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (
__cÚ¡
 *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2));

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 
__cÚ¡
 *
	`šdex
 (__cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__butš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

482 
	`šdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


484  
	`__butš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (
__cÚ¡
 *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 
__cÚ¡
 *
	`ršdex
 (__cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__butš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

510 
	`ršdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


512  
	`__butš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (
__cÚ¡
 *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 #ifdeà
__GNUC__


530 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

531 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

536 
	$¡rÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

537 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

540 
	$¡ºÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

541 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

544 #ifdef 
__USE_GNU


547 
	$¡rÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

548 
__loÿË_t
 
__loc
)

549 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

551 
	$¡ºÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

552 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

553 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

556 #ifdef 
__USE_BSD


559 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

560 
__cÚ¡
 *
__»¡riù
 
__d–im
)

561 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

564 #ifdef 
__USE_XOPEN2K8


566 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

569 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

577 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

578 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

579 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

580 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

581 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 #ifdef 
__USE_GNU


586 
	$¡rv”scmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

587 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

590 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

595 #iâdeà
ba£Çme


600 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


601 "C++" *
	$ba£Çme
 (*
__f’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

603 "C++" 
__cÚ¡
 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
)

604 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

606 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

612 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

613 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

614 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


634 
	~<b™s/¡ršg.h
>

637 
	~<b™s/¡ršg2.h
>

640 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


642 
	~<b™s/¡ršg3.h
>

646 
__END_DECLS


	@common.h

1 
	tušt32
;

2 
	tšt32
;

3 
	tušt16
;

4 
	tšt16
;

5 
	tušt8
;

6 
	tšt8
;

8 
	#NULL
 (*)0

	)

9 
outb
(
ušt16
 
pÜt
, 
ušt8
 
v®ue
);

10 
buzywa™
(
ušt32
 
time
);

11 
ušt16
 
šw
(ušt16 
pÜt
);

12 
ušt8
 
šb
(
ušt16
 
pÜt
);

13 
mem£t
(
ušt32
 *
de¡
, 
v®
, ušt32 
Ën
);

14 
ou
(
ušt32
 
v
, 
ušt16
 
pÜt
);

15 
ušt32
 
šl
(
ušt16
 
pÜt
);

	@debug.h

1 
DoCÜeDump
();

	@gdt.h

1 
	~"commÚ.h
"

2 
	sgdt_’Œy


4 
ušt16
 
	mlim™low
;

5 
ušt16
 
	mba£low
;

6 
ušt8
 
	mba£middË
;

7 
ušt8
 
	macûssby‹
;

8 
ušt8
 
	mlim™highªdæag
;

9 
ušt8
 
	mba£high
;

10 }
__©Œibu‹__
((
·cked
));

12 
gdt_’Œy
 
	tgdt_’Œy_s
;

14 
	sgdt_desc


16 
ušt16
 
	msize
;

17 
ušt32
 
	mgdt_add»ss
;

19 
gdt_desc
 
	tgdt_desc_s
;

20 
š™Ÿlizegdt
();

	@idt.h

1 
	~"commÚ.h
"

2 
	sIDTDesü
{

3 
ušt16
 
	moff£t_1
;

4 
ušt16
 
	m£ËùÜ
;

5 
ušt8
 
	mz”o
;

6 
ušt8
 
	mty³_©Œ
;

7 
ušt16
 
	moff£t_2
;

8 }
__©Œibu‹__
((
·cked
));

11 
	sidt_±r


13 
ušt16
 
	mlim™
;

14 
ušt32
 
	mba£
;

15 } 
__©Œibu‹__
((
·cked
));

18 
IDTDesü
 
	tIDTDesü_t
;

19 
idt_±r
 
	tidt_±r_t
;

21 
i¤0
();

22 
i¤1
();

23 
i¤2
();

24 
i¤8
();

25 
i¤14
();

26 
i¤32
();

27 
i¤33
();

	@iheap.h

1 
	~"commÚ.h
"

2 
ušt32
 
km®loc
Ğušt32 
size
 );

3 
ušt32
 
im®loc
(
size
);

4 
kä“
(
ušt32
 
add»ss
);

	@isr.h

2 
	s»gs


4 
	mgs
, 
	mfs
, 
	mes
, 
	mds
;

5 
	medi
, 
	mesi
, 
	mebp
, 
	me¥
, 
	mebx
, 
	medx
, 
	mecx
, 
	m—x
;

6 
	mšt_no
, 
	m”r_code
;

7 
	me
, 
	mcs
, 
	meæags
, 
	mu£»¥
, 
	mss
;

10 
»gs
 
	t»gi¡”s_t
;

13 (*
	tœq_hªdËr
)(
	t»gi¡”s_t
 *
	tr
) ;

14 
	`©chœqhªdËr
(
œq_hªdËr
 
fun
, 
œq_numb”
);

15 
	`š™Ÿlizeidt
();

	@keyboard.h

6 
	gkbdus
[128] =

	@multiboot.h

22 #iâdeà
MULTIBOOT_HEADER


23 
	#MULTIBOOT_HEADER
 1

	)

26 
	#MULTIBOOT_SEARCH
 8192

	)

29 
	#MULTIBOOT_HEADER_MAGIC
 0x1BADB002

	)

32 
	#MULTIBOOT_BOOTLOADER_MAGIC
 0x2BADB002

	)

35 
	#MULTIBOOT_UNSUPPORTED
 0x0000fffc

	)

38 
	#MULTIBOOT_MOD_ALIGN
 0x00001000

	)

41 
	#MULTIBOOT_INFO_ALIGN
 0x00000004

	)

46 
	#MULTIBOOT_PAGE_ALIGN
 0x00000001

	)

49 
	#MULTIBOOT_MEMORY_INFO
 0x00000002

	)

52 
	#MULTIBOOT_VIDEO_MODE
 0x00000004

	)

55 
	#MULTIBOOT_AOUT_KLUDGE
 0x00010000

	)

60 
	#MULTIBOOT_INFO_MEMORY
 0x00000001

	)

62 
	#MULTIBOOT_INFO_BOOTDEV
 0x00000002

	)

64 
	#MULTIBOOT_INFO_CMDLINE
 0x00000004

	)

66 
	#MULTIBOOT_INFO_MODS
 0x00000008

	)

71 
	#MULTIBOOT_INFO_AOUT_SYMS
 0x00000010

	)

73 
	#MULTIBOOT_INFO_ELF_SHDR
 0X00000020

	)

76 
	#MULTIBOOT_INFO_MEM_MAP
 0x00000040

	)

79 
	#MULTIBOOT_INFO_DRIVE_INFO
 0x00000080

	)

82 
	#MULTIBOOT_INFO_CONFIG_TABLE
 0x00000100

	)

85 
	#MULTIBOOT_INFO_BOOT_LOADER_NAME
 0x00000200

	)

88 
	#MULTIBOOT_INFO_APM_TABLE
 0x00000400

	)

91 
	#MULTIBOOT_INFO_VIDEO_INFO
 0x00000800

	)

93 #iâdeà
ASM_FILE


95 
	tmuÉiboÙ_ušt16_t
;

96 
	tmuÉiboÙ_ušt32_t
;

97 
	tmuÉiboÙ_ušt64_t
;

99 
	smuÉiboÙ_h—d”


102 
muÉiboÙ_ušt32_t
 
	mmagic
;

105 
muÉiboÙ_ušt32_t
 
	mæags
;

108 
muÉiboÙ_ušt32_t
 
	mchecksum
;

111 
muÉiboÙ_ušt32_t
 
	mh—d”_addr
;

112 
muÉiboÙ_ušt32_t
 
	mlßd_addr
;

113 
muÉiboÙ_ušt32_t
 
	mlßd_’d_addr
;

114 
muÉiboÙ_ušt32_t
 
	mbss_’d_addr
;

115 
muÉiboÙ_ušt32_t
 
	m’Œy_addr
;

118 
muÉiboÙ_ušt32_t
 
	mmode_ty³
;

119 
muÉiboÙ_ušt32_t
 
	mwidth
;

120 
muÉiboÙ_ušt32_t
 
	mheight
;

121 
muÉiboÙ_ušt32_t
 
	md•th
;

125 
	smuÉiboÙ_aout_symbŞ_bË


127 
muÉiboÙ_ušt32_t
 
	mbsize
;

128 
muÉiboÙ_ušt32_t
 
	m¡rsize
;

129 
muÉiboÙ_ušt32_t
 
	maddr
;

130 
muÉiboÙ_ušt32_t
 
	m»£rved
;

132 
muÉiboÙ_aout_symbŞ_bË
 
	tmuÉiboÙ_aout_symbŞ_bË_t
;

135 
	smuÉiboÙ_–f_£ùiÚ_h—d”_bË


137 
muÉiboÙ_ušt32_t
 
	mnum
;

138 
muÉiboÙ_ušt32_t
 
	msize
;

139 
muÉiboÙ_ušt32_t
 
	maddr
;

140 
muÉiboÙ_ušt32_t
 
	mshndx
;

142 
muÉiboÙ_–f_£ùiÚ_h—d”_bË
 
	tmuÉiboÙ_–f_£ùiÚ_h—d”_bË_t
;

144 
	smuÉiboÙ_šfo


147 
muÉiboÙ_ušt32_t
 
	mæags
;

150 
muÉiboÙ_ušt32_t
 
	mmem_low”
;

151 
muÉiboÙ_ušt32_t
 
	mmem_uµ”
;

154 
muÉiboÙ_ušt32_t
 
	mboÙ_deviû
;

157 
muÉiboÙ_ušt32_t
 
	mcmdlše
;

160 
muÉiboÙ_ušt32_t
 
	mmods_couÁ
;

161 
muÉiboÙ_ušt32_t
 
	mmods_addr
;

165 
muÉiboÙ_aout_symbŞ_bË_t
 
	maout_sym
;

166 
muÉiboÙ_–f_£ùiÚ_h—d”_bË_t
 
	m–f_£c
;

167 } 
	mu
;

170 
muÉiboÙ_ušt32_t
 
	mmm­_Ëngth
;

171 
muÉiboÙ_ušt32_t
 
	mmm­_addr
;

174 
muÉiboÙ_ušt32_t
 
	mdrives_Ëngth
;

175 
muÉiboÙ_ušt32_t
 
	mdrives_addr
;

178 
muÉiboÙ_ušt32_t
 
	mcÚfig_bË
;

181 
muÉiboÙ_ušt32_t
 
	mboÙ_lßd”_Çme
;

184 
muÉiboÙ_ušt32_t
 
	m­m_bË
;

187 
muÉiboÙ_ušt32_t
 
	mvbe_cÚŒŞ_šfo
;

188 
muÉiboÙ_ušt32_t
 
	mvbe_mode_šfo
;

189 
muÉiboÙ_ušt16_t
 
	mvbe_mode
;

190 
muÉiboÙ_ušt16_t
 
	mvbe_š‹rçû_£g
;

191 
muÉiboÙ_ušt16_t
 
	mvbe_š‹rçû_off
;

192 
muÉiboÙ_ušt16_t
 
	mvbe_š‹rçû_Ën
;

194 
muÉiboÙ_šfo
 
	tmuÉiboÙ_šfo_t
;

196 
	smuÉiboÙ_mm­_’Œy


198 
muÉiboÙ_ušt32_t
 
	msize
;

199 
muÉiboÙ_ušt64_t
 
	maddr
;

200 
muÉiboÙ_ušt64_t
 
	mËn
;

201 
	#MULTIBOOT_MEMORY_AVAILABLE
 1

	)

202 
	#MULTIBOOT_MEMORY_RESERVED
 2

	)

203 
muÉiboÙ_ušt32_t
 
	mty³
;

204 } 
__©Œibu‹__
((
·cked
));

205 
muÉiboÙ_mm­_’Œy
 
	tmuÉiboÙ_memÜy_m­_t
;

207 
	smuÉiboÙ_mod_li¡


210 
muÉiboÙ_ušt32_t
 
	mmod_¡¬t
;

211 
muÉiboÙ_ušt32_t
 
	mmod_’d
;

214 
muÉiboÙ_ušt32_t
 
	mcmdlše
;

217 
muÉiboÙ_ušt32_t
 
	m·d
;

219 
muÉiboÙ_mod_li¡
 
	tmuÉiboÙ_moduË_t
;

	@network.h

2 
D‘eùN‘wÜkDeviûs
();

	@pci.h

1 
	~"commÚ.h
"

3 
SŒobePciDeviûs
();

5 
checkpc™abË
(
ušt16
 
deviûid
, ušt16 
v’dÜid
);

6 
ušt32
 
PciR—dRegi¡”
(ušt32 
BusNumb”
, ušt32 
DeviûNumb”
, ušt32 
Regi¡”
);

7 
ušt32
 
PciSŒobeRegi¡”
(ušt32 
BusNumb”
, ušt32 
DeviûNumb”
, ušt32 
Regi¡”
);

	@pci2.h

1 #iâdeà
PCI_H


2 
	#PCI_H


	)

4 
	#PCI_CONFIG_ADDRESS
 0xCF8

	)

5 
	#PCI_CONFIG_DATA
 0xCFC

	)

7 
	#PCI_VENDOR
 0x00

	)

8 
	#PCI_DEVICE
 0x02

	)

9 
	#PCI_CLASS
 0x0B

	)

10 
	#PCI_SUBCLASS
 0x0A

	)

11 
	#PCI_PROGIF
 0x09

	)

12 
	#PCI_REVISION
 0x08

	)

14 
pci_sÿn
();

16 
pci_sÿn
();

	@screen.h

1 
´štk
(
Ëv–
, *
mes§ge
);

2 
S‘Cu¼’tDebugLev–
(
ÃwËv–
);

3 
putch
(
ch
);

4 
şr
();

5 
puts
(*);

6 
putšt
(
i
);

7 
´šthex
(
i
);

8 
BlškCursÜ
();

9 
´štf
 (cÚ¡ *
fÜm©
, ...);

	@timer.h

1 
DoBlšk
();

	@vm.h

1 
	~"commÚ.h
"

2 
	sv·ge


4 
ušt32
 
	m´e£Á
 : 1;

5 
ušt32
 
	mrw
 : 1;

6 
ušt32
 
	mu£r
 : 1;

7 
ušt32
 
	macûs£d
 : 1;

8 
ušt32
 
	mdœty
 : 1;

9 
ušt32
 
	munu£d
 : 7;

10 
ušt32
 
	mäame
 : 20;

11 }
	tv·ge_t
;

13 
	sv·g‘abË


15 
v·ge_t
 
	m·ges
[1024];

16 }
	tv·g‘abË_t
;

18 
	s·gedœ


20 
v·g‘abË_t
 *
	mbËs
[1024];

21 
ušt32
 
	mphysiÿl
[1024];

22 }
	tv·gedœ_t
;

24 
v·gedœ_t
 *
	gwÜkšg_·ge_dœeùÜy
;

26 
In™ŸlizePagšg
();

27 
AÎocF¿me
(
ušt32
 
add»ss
, 
v·gedœ_t
 *
dœ
);

29 
chªgePagedœ
(
v·gedœ_t
 *
dœ
);

	@
1
.
1
/usr/include
30
244
common.c
debug.c
gdt.c
idt.c
iheap.c
isr.c
main.c
network.c
pci.c
pci2.c
pcinet.c
screen.c
test.c
timer.c
vm.c
/usr/include/string.h
common.h
debug.h
gdt.h
idt.h
iheap.h
isr.h
keyboard.h
multiboot.h
network.h
pci.h
pci2.h
screen.h
timer.h
vm.h
